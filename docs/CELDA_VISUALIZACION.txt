# AGREGAR ESTA CELDA AL NOTEBOOK
# Insertar despu√©s de la celda "5. Cargar Datos a Neo4j"

## 5.1. Visualizaci√≥n del Grafo Neo4j

### C√≥digo para copiar y pegar en una nueva celda:

```python
# Visualizaci√≥n del Grafo Neo4j

print("=== VISUALIZACI√ìN DEL GRAFO ===\n")

# Opci√≥n 1: Tabla de nodos
print("[OPCI√ìN 1] Ver nodos en tablas\n")

# Productos
query_productos = """
MATCH (p:Producto)-[:VENDIDO_POR]->(v:Vendedor)
RETURN p.nombre as Producto, p.precio as Precio, p.stock as Stock,
       p.categoria as Categoria, v.nombre as Vendedor, p.ubicacion as Ubicacion
ORDER BY p.categoria, p.precio
"""
df_productos_viz = pd.DataFrame(neo4j_conn.query(query_productos))
print("PRODUCTOS EN NEO4J:")
display(df_productos_viz)

# Vendedores
print("\nVENDEDORES EN NEO4J:")
query_vendedores = """
MATCH (v:Vendedor)
RETURN v.nombre as Vendedor, v.ciudad as Ciudad, 
       v.calificacion as Calificaci√≥n, v.especialidad as Especialidad
"""
df_vendedores_viz = pd.DataFrame(neo4j_conn.query(query_vendedores))
display(df_vendedores_viz)

# Resumen
print("\nRESUMEN DEL GRAFO:")
query_stats = """
MATCH (n) RETURN labels(n)[0] as Tipo, count(n) as Cantidad
"""
df_stats = pd.DataFrame(neo4j_conn.query(query_stats))
display(df_stats)

# Relaciones
query_rel = """
MATCH ()-[r]->() RETURN type(r) as Tipo_Relaci√≥n, count(r) as Cantidad
"""
df_rel = pd.DataFrame(neo4j_conn.query(query_rel))
display(df_rel)

print("\n" + "="*70)
print("[OPCI√ìN 2] Visualizaci√≥n interactiva con pyvis")
print("="*70)

try:
    from pyvis.network import Network
    
    def crear_grafo_interactivo():
        # Obtener nodos
        nodos = neo4j_conn.query("MATCH (n) RETURN id(n) as id, labels(n) as labels, properties(n) as props")
        relaciones = neo4j_conn.query("MATCH (n)-[r]->(m) RETURN id(n) as source, id(m) as target, type(r) as type")
        
        # Crear red
        net = Network(height="750px", width="100%", bgcolor="#f8f9fa", font_color="black")
        net.barnes_hut(gravity=-5000, central_gravity=0.3, spring_length=150)
        
        # Agregar nodos
        for nodo in nodos:
            node_id = nodo['id']
            label_type = nodo['labels'][0] if nodo['labels'] else 'Unknown'
            props = nodo['props']
            
            if label_type == 'Producto':
                titulo = f"<b>{props.get('nombre', 'N/A')}</b><br>Precio: ${props.get('precio', 'N/A')}<br>Stock: {props.get('stock', 'N/A')}<br>Categor√≠a: {props.get('categoria', 'N/A')}"
                color = '#e74c3c'  # Rojo
                size = 20
            elif label_type == 'Vendedor':
                titulo = f"<b>{props.get('nombre', 'N/A')}</b><br>Ciudad: {props.get('ciudad', 'N/A')}<br>‚≠ê {props.get('calificacion', 'N/A')}"
                color = '#3498db'  # Azul
                size = 30
            else:
                titulo = str(props)
                color = '#95a5a6'
                size = 15
            
            net.add_node(
                node_id,
                label=props.get('nombre', label_type),
                title=titulo,
                color=color,
                size=size,
                font={'size': 14}
            )
        
        # Agregar relaciones
        for rel in relaciones:
            net.add_edge(
                rel['source'],
                rel['target'],
                title=rel['type'],
                label=rel['type'],
                color='#7f8c8d',
                width=2
            )
        
        # Opciones de visualizaci√≥n
        net.set_options("""
        {
            "physics": {
                "enabled": true,
                "barnesHut": {
                    "gravitationalConstant": -5000,
                    "centralGravity": 0.3,
                    "springLength": 150,
                    "springConstant": 0.04
                }
            },
            "interaction": {
                "hover": true,
                "tooltipDelay": 100,
                "navigationButtons": true,
                "keyboard": true
            },
            "nodes": {
                "font": {
                    "size": 14,
                    "face": "arial"
                }
            }
        }
        """)
        
        # Guardar
        output_file = "grafo_neo4j_productos.html"
        net.show(output_file)
        
        print(f"‚úì Grafo interactivo creado: {output_file}")
        print(f"  üìä Nodos: {len(nodos)}")
        print(f"  üîó Relaciones: {len(relaciones)}")
        print(f"\nüåê Abre el archivo '{output_file}' en tu navegador")
        print("   - Nodos ROJOS = Productos")
        print("   - Nodos AZULES = Vendedores")
        print("   - Pasa el mouse sobre los nodos para m√°s info")
        print("   - Arrastra los nodos para reorganizar")
        
        return output_file
    
    archivo_grafo = crear_grafo_interactivo()
    
except ImportError:
    print("‚ö† pyvis no instalado. Instalando...")
    import subprocess
    subprocess.check_call([sys.executable, "-m", "pip", "install", "pyvis"])
    print("‚úì pyvis instalado. Ejecuta esta celda nuevamente para ver el grafo")

print("\n" + "="*70)
print("[OPCI√ìN 3] Usar Neo4j Browser (Recomendado)")
print("="*70)
print("\n1. Abre: http://localhost:7474")
print(f"2. Usuario: {NEO4J_USER}")
print("3. Password: [tu contrase√±a de Neo4j]")
print("\nüìã Queries √∫tiles:")
print("\n   Ver todo:")
print("   MATCH (n) RETURN n LIMIT 50")
print("\n   Ver productos y vendedores:")
print("   MATCH (p:Producto)-[r:VENDIDO_POR]->(v:Vendedor) RETURN p, r, v")
print("\n   Productos por categor√≠a:")
print("   MATCH (p:Producto) WHERE p.categoria = 'Electronica' RETURN p")
print("\n   Vendedores y sus productos:")
print("   MATCH (v:Vendedor)<-[:VENDIDO_POR]-(p:Producto)")
print("   RETURN v.nombre, collect(p.nombre) as productos")
```

### Resultado esperado:
- Tablas mostrando productos y vendedores
- Archivo HTML interactivo (`grafo_neo4j_productos.html`)
- Instrucciones para Neo4j Browser
